<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Programación de Servidores</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;500;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; }

        /* Smooth transitions */
        .smooth-transition {
            transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }

        /* Background Gradient Animation */
        .animated-bg {
            background: linear-gradient(-45deg, #0f172a, #1e1b4b, #312e81, #0f172a);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Scrollbar hide */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Custom Scrollbar for Modals */
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: rgba(99, 102, 241, 0.5);
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background-color: rgba(255, 255, 255, 0.05);
        }

        /* Blur Classes for Background */
        .blurred {
            filter: blur(8px) brightness(0.7);
            transform: scale(0.98);
            pointer-events: none;
        }

        /* Animation for Chart Bars */
        .chart-bar-fill {
            width: 0;
            transition: width 1.5s cubic-bezier(0.22, 1, 0.36, 1);
        }

        /* Small helper to visually hide temporary elements used for color computation */
        .visually-hidden { position: absolute !important; width: 1px; height: 1px; margin: -1px; border: 0; padding: 0; overflow: hidden; clip: rect(0 0 0 0); white-space: nowrap; }
    </style>
</head>
<body class="bg-gray-900 text-white h-screen overflow-hidden animated-bg selection:bg-indigo-500 selection:text-white">

    <!-- CONTENEDOR PRINCIPAL (Lo que se desenfoca) -->
    <div id="main-canvas" class="h-full w-full flex flex-col smooth-transition origin-center">

        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-center px-8 py-6 z-10 gap-4">
            <div class="text-center md:text-left">
                <h1 id="app-title" class="text-3xl md:text-4xl font-extrabold tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 to-cyan-400">
                    Programación de Servidores
                </h1>
                <p id="app-subtitle" class="text-gray-300 text-sm font-medium mt-1 tracking-wide">Niveles de dificultad de programar servidores</p>
            </div>

            <div class="flex gap-3">
                <!-- Botón Versiones Core -->
                <button type="button" onclick="openVersionsModal()" class="group relative p-3 px-5 rounded-full bg-indigo-500/10 hover:bg-indigo-500/20 border border-indigo-400/30 transition-all duration-300 shadow-lg backdrop-blur-md flex items-center gap-2 text-sm font-medium text-indigo-300 hover:text-white">
                    <i data-lucide="server" class="w-5 h-5"></i>
                    <span id="versions-btn-text">Ver Versiones Core</span>
                </button>

                <!-- Botón Ajustes -->
                <button type="button" onclick="toggleSettings()" class="group relative p-3 rounded-full bg-white/5 hover:bg-white/10 border border-white/10 transition-all duration-300 hover:rotate-90 shadow-lg backdrop-blur-md">
                    <i data-lucide="settings" class="w-6 h-6 text-gray-300 group-hover:text-white"></i>
                </button>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="flex-grow overflow-y-auto no-scrollbar px-4 pb-20 scroll-smooth">
            <!-- Grid Scrollable -->
            <div id="cards-grid" class="container mx-auto grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 p-4">
                <!-- JS inyectará las tarjetas aquí -->
            </div>

            <!-- Sección Gráfica de Barras -->
            <div class="container mx-auto p-4 mt-12 mb-12">
                <h2 class="text-2xl font-bold mb-6 text-center text-indigo-300 border-t border-white/10 pt-8">Gráfica de Complejidad Técnica</h2>
                <div class="bg-gray-800/50 backdrop-blur-md rounded-3xl p-8 border border-white/5 shadow-2xl">
                    <div id="difficulty-chart" class="flex flex-col gap-3">
                        <!-- Chart rows injected by JS -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- CAPA DE MODALES (Overlay) -->

    <!-- Modal de Versiones Core -->
    <div id="versions-modal" class="fixed inset-0 z-50 flex items-center justify-center opacity-0 pointer-events-none smooth-transition" role="dialog" aria-modal="true" aria-hidden="true">
        <div onclick="closeAll()" class="absolute inset-0 bg-black/40"></div>

        <div class="bg-gray-800/95 backdrop-blur-xl border border-white/10 rounded-3xl p-8 max-w-4xl w-full mx-4 shadow-2xl transform scale-90 translate-y-4 smooth-transition relative overflow-hidden group" id="versions-card" role="document" tabindex="-1">

            <div class="relative z-10 flex flex-col h-full max-h-[90vh]">
                <div class="flex justify-between items-start mb-6 flex-shrink-0">
                    <div>
                        <h2 id="v-title" class="text-3xl font-bold text-white">Versiones y Forks de Servidor</h2>
                        <p class="text-gray-400 font-medium text-sm mt-1">APIs y Motores principales de la comunidad.</p>
                    </div>
                    <button type="button" onclick="closeAll()" class="p-2 rounded-full bg-white/5 hover:bg-white/20 transition-colors">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>

                <div class="overflow-x-auto overflow-y-auto pr-2 custom-scrollbar">
                    <table class="min-w-full table-auto text-sm">
                        <thead class="sticky top-0 bg-gray-700/70 backdrop-blur-sm">
                            <tr>
                                <th class="p-3 text-left text-xs font-bold text-gray-300 uppercase tracking-wider">Nombre</th>
                                <th class="p-3 text-left text-xs font-bold text-gray-300 uppercase tracking-wider hidden sm:table-cell">Tipo</th>
                                <th class="p-3 text-left text-xs font-bold text-gray-300 uppercase tracking-wider hidden lg:table-cell">Año</th>
                                <th class="p-3 text-left text-xs font-bold text-gray-300 uppercase tracking-wider">Uso Principal</th>
                                <th class="p-3 text-left text-xs font-bold text-gray-300 uppercase tracking-wider hidden md:table-cell">Curiosidad</th>
                            </tr>
                        </thead>
                        <tbody id="versions-tbody" class="divide-y divide-white/5">
                            <!-- Data injected by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Detalles -->
    <div id="detail-modal" class="fixed inset-0 z-50 flex items-center justify-center opacity-0 pointer-events-none smooth-transition" role="dialog" aria-modal="true" aria-hidden="true">
        <div onclick="closeAll()" class="absolute inset-0 bg-black/40"></div>

        <div class="bg-gray-800/95 backdrop-blur-xl border border-white/10 rounded-3xl p-8 max-w-2xl w-full mx-4 shadow-2xl transform scale-90 translate-y-4 smooth-transition relative overflow-hidden group" id="detail-card" role="document" tabindex="-1">
            <!-- Glow effect behind -->
            <div id="modal-glow" class="absolute -top-20 -right-20 w-64 h-64 rounded-full blur-[100px] opacity-20 pointer-events-none transition-colors duration-500"></div>

            <div class="relative z-10 flex flex-col h-full max-h-[80vh]">
                <div class="flex justify-between items-start mb-6 flex-shrink-0">
                    <div>
                        <span id="m-level" class="text-xs font-bold uppercase tracking-widest text-indigo-400 mb-1 block">Nivel 1</span>
                        <h2 id="m-title" class="text-3xl font-bold text-white">.yml</h2>
                        <p id="m-ext" class="text-gray-400 font-mono text-sm mt-1">YAML Configuration</p>
                    </div>
                    <button type="button" onclick="closeAll()" class="p-2 rounded-full bg-white/5 hover:bg-white/20 transition-colors">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>

                <div class="space-y-6 overflow-y-auto pr-2 custom-scrollbar">
                    <div class="bg-white/5 rounded-xl p-5 border border-white/5 hover:border-white/10 transition-colors">
                        <h3 id="lbl-whatis" class="text-xs text-gray-500 uppercase font-bold mb-2">Qué es</h3>
                        <p id="m-whatis" class="text-gray-200 leading-relaxed text-sm md:text-base">Descripción...</p>
                    </div>

                    <div class="bg-white/5 rounded-xl p-5 border border-white/5 hover:border-white/10 transition-colors">
                        <h3 id="lbl-whatdo" class="text-xs text-gray-500 uppercase font-bold mb-2">Qué haces</h3>
                        <p id="m-whatdo" class="text-gray-200 leading-relaxed text-sm md:text-base">Acción...</p>
                    </div>

                    <div class="pb-2">
                        <div class="flex justify-between items-end mb-2">
                            <h3 id="lbl-prog" class="text-xs text-gray-500 uppercase font-bold">Nivel de Programación</h3>
                            <span id="m-prog-val" class="text-sm font-bold text-indigo-400">Bajo</span>
                        </div>
                        <div class="h-3 w-full bg-gray-700/50 rounded-full overflow-hidden backdrop-blur-sm border border-white/5">
                            <div id="m-bar" class="h-full bg-indigo-500 rounded-full transition-all duration-1000 ease-out w-0 shadow-[0_0_15px_rgba(99,102,241,0.5)]"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Ajustes (Settings) -->
    <div id="settings-modal" class="fixed inset-0 z-50 flex items-center justify-center opacity-0 pointer-events-none smooth-transition" role="dialog" aria-modal="true" aria-hidden="true">
        <div onclick="closeAll()" class="absolute inset-0"></div>

        <div class="bg-gray-800/90 backdrop-blur-xl border border-white/10 rounded-2xl p-6 w-80 shadow-2xl transform scale-95 smooth-transition" id="settings-card" role="document" tabindex="-1">
            <h3 id="st-title" class="text-xl font-bold mb-4 text-center">Ajustes / Settings</h3>

            <div class="space-y-3">
                <button type="button" onclick="changeLang('es')" class="w-full py-3 px-4 rounded-xl flex items-center justify-between bg-white/5 hover:bg-indigo-600/20 border border-white/5 hover:border-indigo-500/50 transition-all group">
                    <span class="font-medium">Español</span>
                    <span id="check-es" class="opacity-100 text-indigo-400"><i data-lucide="check" class="w-4 h-4"></i></span>
                </button>
                <button type="button" onclick="changeLang('en')" class="w-full py-3 px-4 rounded-xl flex items-center justify-between bg-white/5 hover:bg-indigo-600/20 border border-white/5 hover:border-indigo-500/50 transition-all group">
                    <span class="font-medium">English</span>
                    <span id="check-en" class="opacity-0 text-indigo-400"><i data-lucide="check" class="w-4 h-4"></i></span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- DATA OBJECT ---
        const content = {
            es: {
                appTitle: "Programación de Servidores",
                appSubtitle: "Niveles de dificultad de programar servidores",
                settingsTitle: "Idioma / Language",
                versionsBtn: "Ver Versiones Core",
                versionsTitle: "Versiones y Forks de Servidor",
                lblWhatIs: "EXPLICACIÓN DETALLADA",
                lblWhatDo: "TAREAS Y RESPONSABILIDADES",
                lblProg: "COMPLEJIDAD TÉCNICA",
                /* levels and serverVersions trimmed in this snippet for brevity in this view, keep your original arrays here */
                levels: [ /* ... keep your original levels array here ... */ ],
                serverVersions: [ /* ... keep your original serverVersions array here ... */ ]
            },
            en: {
                appTitle: "Server Programming",
                appSubtitle: "Server Programming Difficulty Levels",
                settingsTitle: "Language / Idioma",
                versionsBtn: "View Core Versions",
                versionsTitle: "Server Versions and Forks",
                lblWhatIs: "DETAILED EXPLANATION",
                lblWhatDo: "TASKS AND RESPONSIBILITIES",
                lblProg: "TECHNICAL COMPLEXITY",
                levels: [ /* ... keep your original levels array here ... */ ],
                serverVersions: [ /* ... keep your original serverVersions array here ... */ ]
            }
        };

        // --- GLOBAL STATE & UTILS ---
        let currentLang = localStorage.getItem('lang') || 'es';
        let currentContent;
        const mainCanvas = document.getElementById('main-canvas');

        const modals = [
            { id: 'versions-modal', cardId: 'versions-card' },
            { id: 'detail-modal', cardId: 'detail-card' },
            { id: 'settings-modal', cardId: 'settings-card' }
        ];

        // Helper to compute applied background color for a Tailwind class at runtime
        function getColorFromTailwindClass(twClass) {
            // Create a temporary element, apply the Tailwind class, read computed background-color
            const tmp = document.createElement('span');
            tmp.className = `${twClass} visually-hidden`;
            document.body.appendChild(tmp);
            const style = getComputedStyle(tmp).backgroundColor;
            document.body.removeChild(tmp);
            return style || '';
        }

        // --- CORE FUNCTIONS ---

        function updateUI() {
            currentContent = content[currentLang];

            // Update Header & Settings
            document.getElementById('app-title').textContent = currentContent.appTitle;
            document.getElementById('app-subtitle').textContent = currentContent.appSubtitle;
            document.getElementById('versions-btn-text').textContent = currentContent.versionsBtn;
            document.getElementById('v-title').textContent = currentContent.versionsTitle;
            document.getElementById('st-title').textContent = currentContent.settingsTitle;

            // Update labels in the detail modal (even when closed)
            document.getElementById('lbl-whatis').textContent = currentContent.lblWhatIs;
            document.getElementById('lbl-whatdo').textContent = currentContent.lblWhatDo;
            document.getElementById('lbl-prog').textContent = currentContent.lblProg;

            // Update language checks
            document.getElementById('check-es').style.opacity = currentLang === 'es' ? 1 : 0;
            document.getElementById('check-en').style.opacity = currentLang === 'en' ? 1 : 0;

            populateCards();
            populateChart();

            // Re-render icons
            if (typeof lucide !== 'undefined' && lucide.createIcons) {
                lucide.createIcons();
            }
        }

        function changeLang(lang) {
            currentLang = lang;
            localStorage.setItem('lang', lang);
            closeAll();
            updateUI();
        }

        function populateCards() {
            const grid = document.getElementById('cards-grid');
            grid.innerHTML = ''; // Clear previous cards

            currentContent.levels.forEach(level => {
                const card = document.createElement('div');
                card.className = 'p-6 rounded-2xl bg-gray-800/50 backdrop-blur-md border border-white/5 shadow-xl cursor-pointer hover:bg-gray-700/60 smooth-transition flex flex-col justify-between space-y-4';
                card.onclick = () => openDetailModal(level);

                const html = `
                    <div class="flex items-center justify-between">
                        <span class="text-xs font-bold uppercase tracking-widest ${level.color}">${currentLang === 'es' ? 'Nivel' : 'Level'} ${level.id + 1}</span>
                        <div class="text-xs font-mono text-gray-400 bg-white/5 px-2 py-1 rounded-full">${level.ext}</div>
                    </div>
                    <div>
                        <h2 class="text-3xl font-extrabold text-white">${level.title}</h2>
                        <p class="text-gray-300 text-sm mt-1">${(level.whatIs || '').split('. ')[0]}...</p>
                    </div>
                    <div class="pt-4 border-t border-white/5">
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-xs text-gray-400 uppercase font-medium">${currentContent.lblProg}</span>
                            <span class="text-sm font-bold ${level.color}">${(level.prog || '').split('. ')[0]}</span>
                        </div>
                        <div class="h-2 w-full bg-gray-700/50 rounded-full overflow-hidden">
                            <div class="h-full ${level.barColor} rounded-full" style="width: ${level.progress};"></div>
                        </div>
                    </div>
                `;
                card.innerHTML = html;
                grid.appendChild(card);
            });
        }

        function populateChart() {
            const chart = document.getElementById('difficulty-chart');
            chart.innerHTML = '';

            currentContent.levels.forEach(level => {
                const row = document.createElement('div');
                row.className = 'flex items-center gap-4 py-2';
                const html = `
                    <div class="w-24 text-right text-xs font-medium text-gray-400 flex-shrink-0">${level.title}</div>
                    <div class="flex-grow h-4 bg-gray-700/50 rounded-full overflow-hidden border border-white/5">
                        <div class="chart-bar-fill h-full ${level.barColor} rounded-full" style="width: ${level.progress};"></div>
                    </div>
                    <div class="w-10 text-left text-sm font-bold ${level.color} flex-shrink-0">${level.progress.replace('%','')}</div>
                `;
                row.innerHTML = html;
                chart.appendChild(row);
            });
            // animate chart bars after insertion
            requestAnimationFrame(() => {
                document.querySelectorAll('.chart-bar-fill').forEach(el => {
                    const w = el.style.width;
                    el.style.width = '0%';
                    setTimeout(() => el.style.width = w, 50);
                });
            });
        }

        function populateVersionsModal() {
            const tbody = document.getElementById('versions-tbody');
            tbody.innerHTML = '';

            currentContent.serverVersions.forEach(version => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-white/5 smooth-transition';

                const html = `
                    <td class="p-3 font-bold text-white">${version.name}</td>
                    <td class="p-3 text-gray-300 hidden sm:table-cell">${version.type}</td>
                    <td class="p-3 text-gray-400 hidden lg:table-cell">${version.year}</td>
                    <td class="p-3 text-gray-200 text-xs">${version.purpose}</td>
                    <td class="p-3 text-gray-500 text-xs italic hidden md:table-cell">${version.curiosity}</td>
                `;
                row.innerHTML = html;
                tbody.appendChild(row);
            });
        }

        // --- MODAL HANDLERS ---

        function openModal(modalId, cardId) {
            const modal = document.getElementById(modalId);
            const card = document.getElementById(cardId);

            mainCanvas.classList.add('blurred');

            modal.classList.remove('opacity-0', 'pointer-events-none');
            modal.setAttribute('aria-hidden', 'false');

            card.classList.remove('scale-90', 'translate-y-4');
            // reset and force final transform
            card.classList.add('scale-100', 'translate-y-0');
            // focus the modal card for accessibility
            setTimeout(() => card.focus(), 120);
        }

        function openVersionsModal() {
            populateVersionsModal();
            openModal('versions-modal', 'versions-card');
        }

        function openDetailModal(levelData) {
            // Update content
            document.getElementById('m-level').textContent = `${currentLang === 'es' ? 'Nivel' : 'Level'} ${levelData.id + 1}`;
            document.getElementById('m-title').textContent = levelData.title;
            document.getElementById('m-ext').textContent = levelData.ext;
            document.getElementById('m-whatis').textContent = levelData.whatIs;
            document.getElementById('m-whatdo').textContent = levelData.whatDo;
            document.getElementById('m-prog-val').textContent = (levelData.prog || '').split('. ')[0];

            // Update bar style safely
            const bar = document.getElementById('m-bar');
            // replace classes while keeping base classes
            bar.className = `h-full ${levelData.barColor} rounded-full transition-all duration-1000 ease-out shadow-[0_0_15px_rgba(99,102,241,0.5)]`;
            // Set initial width to 0 for animation, then set target width
            bar.style.width = '0%';
            setTimeout(() => {
                bar.style.width = levelData.progress;
            }, 50);

            // Compute color from the Tailwind bg class and apply as inline background for glow
            const glow = document.getElementById('modal-glow');
            const computedBg = getColorFromTailwindClass(levelData.barColor);
            if (computedBg) {
                glow.style.backgroundColor = computedBg;
                glow.style.opacity = '0.22';
            } else {
                glow.style.backgroundColor = '';
            }

            openModal('detail-modal', 'detail-card');
        }

        function toggleSettings() {
            const settingsModal = document.getElementById('settings-modal');
            if (settingsModal.classList.contains('opacity-0')) {
                openModal('settings-modal', 'settings-card');
            } else {
                closeAll();
            }
        }

        function closeAll() {
            mainCanvas.classList.remove('blurred');

            modals.forEach(m => {
                const modal = document.getElementById(m.id);
                const card = document.getElementById(m.cardId);

                modal.classList.add('opacity-0', 'pointer-events-none');
                modal.setAttribute('aria-hidden', 'true');

                // Reset card transform for the closing animation
                card.classList.remove('scale-100', 'translate-y-0');
                card.classList.add('scale-90', 'translate-y-4');

                // small delay: blur removal has already happened, reset focused element
                if (document.activeElement && (document.activeElement === card)) {
                    document.activeElement.blur();
                }
            });
        }

        // --- INITIALIZATION ---
        window.addEventListener('load', () => {
            // Put your real arrays back into the content object if you trimmed them for this file
            // (This file kept placeholders in content above to keep the example compact.)
            // If you replaced here, everything will work as-is.

            updateUI();

            // Close modals on escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeAll();
                }
            });

            // Create lucide icons once more in case any dynamic insertion happened after first pass
            if (typeof lucide !== 'undefined' && lucide.createIcons) {
                lucide.createIcons();
            }
        });
    </script>
</body>
</html>